(this["webpackJsonphfa-drone-map"]=this["webpackJsonphfa-drone-map"]||[]).push([[0],{103:function(e,t,n){},139:function(e,t,n){"use strict";n.r(t);n(102),n(103);var r=n(92),a=n(169),o=n(58),i=n(0),c=n.n(i),s=n(24),l=n.n(s),u=n(9),d=n(83),p=n.n(d),b=n(84),f=n.n(b),j=n(170),g=n(1),v=function(e){var t=e.boatId,n=e.waypoints,r=e.disabled,a=void 0!==r&&r,o=e.filename,i=void 0===o?"data.csv":o,c=e.contentType,s=void 0===c?"data:text/csv;charset=utf-8,":c;return Object(g.jsx)(j.a,{disabled:a,onClick:function(){var e="boatId,waypointNumber,latitude,longitude\n";!function(e,t,n){if(navigator.msSaveBlob){var r=new Blob([e],{type:n});navigator.msSaveBlob(r,t)}else{var a=document.createElement("a");a.style.display="none",a.setAttribute("href",n+encodeURIComponent(e)),a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}}(e+=n.map((function(e,n){return h(t,n,e)})).join("\n"),i,s)},children:Object(g.jsx)(f.a,{color:"primary"})})},h=function(e,t,n){return"".concat(e,",").concat(t+1,",").concat(n.lat.toFixed(6),",").concat(n.long.toFixed(6))},x=function(e){var t=e.waypoints,n=c.a.useState(""),r=Object(u.a)(n,2),a=r[0],o=r[1];return Object(g.jsxs)("div",{children:[Object(g.jsx)("input",{placeholder:"Boat ID",value:a,onChange:function(e){return o(e.target.value)}}),Object(g.jsx)(v,{disabled:!a||0===t.length,boatId:a,waypoints:t})]})},m=function(e){var t=e.deleteSignal,n=e.sendDeleteSignal,r=e.setWaypoints;return Object(g.jsx)(j.a,{onClick:function(){window.confirm("Are you sure you wish to delete these waypoints?")&&(r([]),n(!t))},variant:"contained",color:"error",children:"Delete"})},y=n(71),O=n.n(y),C=n(85),S=n(89),w=n.n(S),I=n(88),k=n.n(I),L=n(164),_=function(e){var t=1;return/[SW]$/.test(e)&&(t=-1),t*parseFloat(e.substring(0,e.length-1))},E=n(87),F=n.n(E),B=n(176),N=n(177),D=n(86),M=n.n(D),W=function(e){var t=e.drone;return Object(g.jsx)(B.a,{variant:"outlined",children:Object(g.jsx)(N.a,{children:Object(g.jsxs)("div",{className:M.a.droneId,children:[Object(g.jsx)("div",{children:t.id}),Object(g.jsx)("div",{children:Object(g.jsx)(F.a,{onClick:function(){return console.log([t.long,t.lat])}})})]})})})},A=function(e){var t=e.drones;return t?t.map((function(e){return Object(g.jsx)(W,{drone:e},e.id)})):null},R=n(46),T=n.n(R),P=function(e){var t=c.a.useState("M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0"),n=Object(u.a)(t,2),r=n[0],a=n[1],o=c.a.useState(""),i=Object(u.a)(o,2),s=i[0],l=i[1],d=c.a.useRef(null),p=function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files,console.log(n),e.next=4,Promise.all(Array.from(n).map((function(e){return t=e,new Promise((function(e,n){var r=new FileReader;r.onabort=function(){return n("file reading was aborted")},r.onerror=function(){return n("file reading has failed")},r.readAsText?(r.addEventListener("load",(function(){var t=null!=this.resultString?this.resultString:this.result;e(t)}),!1),r.readAsText(t)):n("Failed to read file")}));var t})));case 4:r=e.sent,a(r.join("\n"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)("div",{className:T.a.fileInputContainer,children:[Object(g.jsx)("input",{type:"file",id:"fileInput",name:"fileInput",ref:d,multiple:!0,onChange:p,className:T.a.uploadInput}),Object(g.jsxs)("div",{className:T.a.buttonBar,children:[Object(g.jsx)(j.a,{onClick:function(){d.current&&d.current.click()},endIcon:Object(g.jsx)(k.a,{}),variant:"contained",color:"secondary",children:"Upload CSV"}),Object(g.jsx)(j.a,{onClick:function(){var t=function(e){var t={};return e.split("\n").forEach((function(e){var n=e.split(",");if(0===n.length||7!==n.length)return null;console.log(n),console.log("chunks length: ",n.length);var r=n[0],a=n[1];if(t[a]||(t[a]={id:a}),"P"===r){var o=Math.round(n[2]/13.61*100,2)+"% ("+n[2]+"/13.61V)";t[a].batteryLvl=o}else if("M"===r){var i=_(n[2]),c=_(n[3]),s=n[4]+" NM/H",l=n[5],u=n[6];t[a].lat=i,t[a].long=c,t[a].avgSpeed=s,t[a].avgBearing=l,t[a].avgCurrent=u}})),Object.values(t)}(r);console.log(t),l(t),e.onSubmit&&e.onSubmit(t)},variant:"contained",color:"primary",endIcon:Object(g.jsx)(w.a,{}),children:"Submit"})]}),Object(g.jsx)(L.a,{className:T.a.textarea,minRows:20,onChange:function(e){return a(e.target.value)},value:r}),Object(g.jsx)(A,{drones:s})]})},J=n(32),U=n(13),V=n.n(U),G={"circle-stroke-width":2,"circle-radius":8,"circle-blur":.15,"circle-color":"#3770C6","circle-stroke-color":"white"},Y=function(e){var t=c.a.useContext(J.c);return c.a.useEffect((function(){if(t){var e=new V.a.Popup({closeButton:!1,closeOnClick:!1});t.on("mouseenter","position-marker",(function(n){t.getCanvas().style.cursor="pointer";for(var r=n.features[0].geometry.coordinates.slice(),a=n.features[0].properties,o="";Math.abs(n.lngLat.lng-r[0])>180;)r[0]+=n.lngLat.lng>r[0]?360:-360;for(var i in e.setLngLat(r).addTo(t),a){var c=i+": ";"DroneID"===i?o+=c="<strong>"+a[i]+"</strong><br>":"id"!==i&&(o+=c+a[i]+"<br>",console.log(a[i]),e.setHTML(o))}})),t.on("click","position-marker",(function(e){t.flyTo({center:e.features[0].geometry.coordinates})})),t.on("mouseenter","position-marker",(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave","position-marker",(function(){t.getCanvas().style.cursor="",e.remove()}))}}),[t]),Object(g.jsx)(J.b,{type:"circle",id:"position-marker",paint:G,children:e.droneLocations.map((function(e,t){return Object(g.jsx)(J.a,{coordinates:[e.long,e.lat],properties:{DroneID:e.id,Longitude:e.long,Latitude:e.lat,"Battery Level":e.batteryLvl,"Average Speed":e.avgSpeed,"Average Bearing":e.avgBearing,"Average Current":e.avgCurrent}},t)}))})},Z=function(e){var t=c.a.useContext(J.c),n=e.initialWaypoints,r=e.deleteSignal,a=e.disabled,o=Object(i.useRef)(null),s=Object(i.useRef)(null),l=Object(i.useRef)(null),d=function(t){var n=t.map((function(e){var t=Object(u.a)(e,2);return{long:t[0],lat:t[1]}}));e.onChange&&e.onChange(n)};function p(e,t){s.current.features.splice(e,0,function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{description:"<p>"+JSON.stringify(e)+"</p>",tag:JSON.stringify(e)}}}(t)),l.current.features[0].geometry.coordinates.splice(e,0,t),b(),d(l.current.features[0].geometry.coordinates)}function b(){t.getSource("lines").setData(l.current),t.getSource("points").setData(s.current)}function f(e){var n,r=[e.point.x,e.point.y],a=r[0],o=r[1],i=t.queryRenderedFeatures([[a-5,o-5],[a+5,o+5]],{layers:["points"]});return i.length>0?(n=i[0].properties.tag,s.current.features.findIndex((function(e){return e.properties.tag===n}))):null}function j(e){if(o.current.a&&o.current.a.index===e)return function(e){s.current.features.splice(e,1),l.current.features[0].geometry.coordinates.splice(e,1),b(),d(l.current.features[0].geometry.coordinates)}(e),void v();o.current.b&&o.current.b.marker.remove(),o.current.a&&(o.current.b=o.current.a);var n=(new V.a.Marker).setLngLat(s.current.features[e].geometry.coordinates).addTo(t);o.current.a={index:e,marker:n}}function g(e){0===s.current.features.length?(p(0,e),j(0)):2===Object.keys(o.current).length?function(e){var t=o.current.a.index,n=o.current.b.index;if(t>n){var r=[n,t];t=r[0],n=r[1]}n-t===1&&(p(n,e),v())}(e):1===Object.keys(o.current).length?function(e){var t=s.current.features.length;o.current.a.index===s.current.features.length-1?(p(t,e),v(),j(t)):0===o.current.a.index&&(p(0,e),v(),j(0))}(e):t.panTo(s.current.features[0].geometry.coordinates)}function v(){o.current.a&&o.current.a.marker.remove(),o.current.b&&o.current.b.marker.remove(),o.current={}}function h(e){27===e.keyCode&&(v(),t.setPitch(0))}function x(e){var n=f(e);null!==n?j(n):g([e.lngLat.lng,e.lngLat.lat]),t.setPitch(0)}function m(){t.setPitch(0)}return c.a.useEffect((function(){if(t&&!a)return function(){o.current={},l.current={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]},s.current={type:"FeatureCollection",features:[]},t.addSource("lines",{type:"geojson",data:l.current}),t.addSource("points",{type:"geojson",data:s.current}),t.addLayer({id:"lines",type:"line",source:"lines",paint:{"line-color":"yellow","line-opacity":.75,"line-width":5}}),t.addLayer({id:"points",type:"circle",source:"points",paint:{"circle-radius":6,"circle-color":"#B42222"}});for(var e=0;e<n.length;e++)p(e,[n[e].long,n[e].lat]);n.length>0&&t.panTo(s.current.features[0].geometry.coordinates)}(),t.on("click",x),t.on("contextmenu",m),window.addEventListener("keydown",h),function(){t.off("click",x),t.off("contextmenu",m),window.removeEventListener("keydown",h),t.removeLayer("lines"),t.removeSource("lines"),t.removeLayer("points"),t.removeSource("points"),v()}}),[t,a,r]),null},q=Object(J.d)({accessToken:"pk.eyJ1Ijoic3BpZGVyMjI5OCIsImEiOiJja3VzOGN1cWUwY2M5MndtZmZ1Nm0wdHZqIn0.rsbsUbg1W7V0Ev9aAXGGsA"}),H=function(e){var t=e.droneLocations,n=e.onChange,r=e.waypoints,a=e.deleteSignal,o=e.disableWaypointEditing;return Object(g.jsx)("div",{children:Object(g.jsxs)(q,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100%",width:"100%"},children:[Object(g.jsx)(Y,{droneLocations:t}),Object(g.jsx)(Z,{onChange:n,initialWaypoints:r,deleteSignal:a,disabled:o})]})})},z=function(e){var t=e.droneLocations,n=e.setWaypoints,r=e.exportMode;return Object(g.jsx)(j.a,{onClick:function(){n([t[0]]),r()},variant:"contained",color:"primary",children:"Start Creating Waypoints from First Drone"})},X=n(60),$=n(93),K=n(173),Q=n(171),ee=n(174),te=n(167),ne=n(172),re=n(90),ae=n.n(re),oe=n(91),ie=n.n(oe),ce=["children","value","index"];function se(e){var t=e.children,n=e.value,r=e.index,a=Object($.a)(e,ce);return Object(g.jsx)("div",Object(X.a)(Object(X.a)({role:"tabpanel",hidden:n!==r,id:"full-width-tabpanel-".concat(r),"aria-labelledby":"full-width-tab-".concat(r)},a),{},{children:n===r&&Object(g.jsx)(Q.a,{sx:{p:3},children:Object(g.jsx)(ne.a,{children:t})})}))}var le=function(e){var t=e.panels,n=e.currentIndex,r=e.setCurrentIndex,a=n;return Object(g.jsxs)(Q.a,{className:ie.a.sidebar,children:[Object(g.jsx)(K.a,{position:"static",children:Object(g.jsx)(te.a,{value:a,onChange:function(e,t){r(t)},indicatorColor:"secondary",textColor:"inherit",variant:"fullWidth",children:t.map((function(e,t){return Object(g.jsx)(ee.a,Object(X.a)({label:e.label},{id:"full-width-tab-".concat(n=t),"aria-controls":"full-width-tabpanel-".concat(n)}),e.label);var n}))})}),Object(g.jsx)(ae.a,{index:a,onChangeIndex:function(e){r(e)},children:t.map((function(e,t){return Object(g.jsx)(se,{value:a,index:t,children:e.contents},e.label)}))})]})};function ue(){var e=c.a.useState(0),t=Object(u.a)(e,2),n=t[0],r=t[1],a=c.a.useState([]),i=Object(u.a)(a,2),s=i[0],l=i[1],d=c.a.useState([]),b=Object(u.a)(d,2),f=b[0],j=b[1],v=c.a.useState(!1),h=Object(u.a)(v,2),y=h[0],O=h[1],C=Object(o.b)().enqueueSnackbar;return Object(g.jsxs)("div",{className:p.a.appContainer,children:[Object(g.jsx)(le,{currentIndex:n,setCurrentIndex:r,panels:[{label:"Import",contents:Object(g.jsxs)("div",{children:[Object(g.jsx)(z,{droneLocations:s,setWaypoints:j,exportMode:function(){return r(1)}}),Object(g.jsx)("button",{onClick:function(){C("I am a message")},children:"show a notification"}),Object(g.jsx)(P,{onSubmit:l})]})},{label:"Export",contents:Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{children:0===f.length?Object(g.jsx)("span",{children:"No waypoints selected"}):Object(g.jsx)("ol",{style:{listStyle:"decimal"},children:f.map((function(e,t){return Object(g.jsx)("li",{children:"[".concat(e.long,", ").concat(e.lat,"]")},t)}))})}),Object(g.jsx)(x,{waypoints:f}),Object(g.jsx)(m,{deleteSignal:y,sendDeleteSignal:O,setWaypoints:j})]})}]}),Object(g.jsx)(H,{droneLocations:s,onChange:j,disableWaypointEditing:0===n,waypoints:f,deleteSignal:y})]})}var de=Object(r.a)({palette:{primary:{main:"#272264"},secondary:{main:"#a7b1b8"}}});l.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(o.a,{maxSnack:3,children:Object(g.jsx)(a.a,{theme:de,children:Object(g.jsx)(ue,{})})})}),document.getElementById("root"))},46:function(e,t,n){e.exports={fileInputContainer:"FileInput_fileInputContainer__2FREY",uploadInput:"FileInput_uploadInput__3LcYe",buttonBar:"FileInput_buttonBar__IRrE5",textarea:"FileInput_textarea__bwjhJ"}},83:function(e,t,n){e.exports={appContainer:"App_appContainer__3jRx1"}},86:function(e,t,n){e.exports={droneId:"Dronecard_droneId__1RcYD"}},91:function(e,t,n){e.exports={sidebar:"Sidebar_sidebar__2go77"}}},[[139,1,2]]]);
//# sourceMappingURL=main.9914a4e9.chunk.js.map