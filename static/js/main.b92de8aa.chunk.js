(this["webpackJsonphfa-drone-map"]=this["webpackJsonphfa-drone-map"]||[]).push([[0],{55:function(e,t,n){e.exports={fileInputContainer:"FileInput_fileInputContainer__2FREY",uploadInput:"FileInput_uploadInput__3LcYe"}},59:function(e,t,n){e.exports={appContainer:"App_appContainer__3jRx1"}},72:function(e,t,n){},92:function(e,t,n){"use strict";n.r(t);n(72);var r=n(0),a=n.n(r),o=n(21),i=n.n(o),c=n(4),u=n(59),s=n.n(u),l=n(117),d=n(1),p=function(e){var t=e.boatId,n=e.waypoints,r=e.disabled,a=void 0!==r&&r,o=e.filename,i=void 0===o?"data.csv":o,c=e.contentType,u=void 0===c?"data:text/csv;charset=utf-8,":c;return Object(d.jsx)(l.a,{disabled:a,onClick:function(){var e="boatId,waypointNumber,latitude,longitude\n";!function(e,t,n){if(navigator.msSaveBlob){var r=new Blob([e],{type:n});navigator.msSaveBlob(r,t)}else{var a=document.createElement("a");a.style.display="none",a.setAttribute("href",n+encodeURIComponent(e)),a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}}(e+=n.map((function(e,n){return f(t,n,e)})).join("\n"),i,u)},children:"download"})},f=function(e,t,n){return"".concat(e,",").concat(t+1,",").concat(n.lat.toFixed(6),",").concat(n.long.toFixed(6))},g=function(e){var t=e.waypoints,n=a.a.useState(""),r=Object(c.a)(n,2),o=r[0],i=r[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("input",{placeholder:"Boat ID",value:o,onChange:function(e){return i(e.target.value)}}),Object(d.jsx)(p,{disabled:!o||0===t.length,boatId:o,waypoints:t})]})},v=n(54),b=n.n(v),j=n(61),m=n(62),y=n.n(m),h=n(118),x=n(115),O=function(e){var t=1;return/[SW]$/.test(e)&&(t=-1),t*parseFloat(e.substring(0,e.length-1))},C=n(55),w=n.n(C),k=function(e){var t=a.a.useState("M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0"),n=Object(c.a)(t,2),r=n[0],o=n[1],i=a.a.useState(""),u=Object(c.a)(i,2),s=u[0],p=u[1],f=function(){var e=Object(j.a)(b.a.mark((function e(t){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files,console.log(n),e.next=4,Promise.all(Array.from(n).map((function(e){return t=e,new Promise((function(e,n){var r=new FileReader;r.onabort=function(){return n("file reading was aborted")},r.onerror=function(){return n("file reading has failed")},r.readAsText?(r.addEventListener("load",(function(){var t=null!=this.resultString?this.resultString:this.result;e(t)}),!1),r.readAsText(t)):n("Failed to read file")}));var t})));case 4:r=e.sent,o(r.join("\n"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:w.a.fileInputContainer,children:[Object(d.jsx)("input",{type:"file",id:"fileInput",name:"fileInput",multiple:!0,onChange:f,className:w.a.uploadInput}),Object(d.jsx)("label",{htmlFor:"fileInput",children:Object(d.jsx)(x.a,{title:"Upload a CSV File",children:Object(d.jsx)(h.a,{component:"span",children:Object(d.jsx)(y.a,{})})})}),Object(d.jsx)("textarea",{value:r,onChange:function(e){return o(e.target.value)},rows:20}),Object(d.jsx)(l.a,{onClick:function(){var t=function(e){var t={};return e.split("\n").forEach((function(e){var n=e.split(",");if(0===n.length||7!==n.length)return null;console.log(n),console.log("chunks length: ",n.length);var r=n[0],a=n[1];if(t[a]||(t[a]={id:a}),"P"===r){var o=Math.round(n[2]/13.61*100,2)+"% ("+n[2]+"/13.61V)";t[a].batteryLvl=o}else if("M"===r){var i=O(n[2]),c=O(n[3]),u=n[4]+" NM/H",s=n[5],l=n[6];t[a].lat=i,t[a].long=c,t[a].avgSpeed=u,t[a].avgBearing=s,t[a].avgCurrent=l}})),Object.values(t)}(r);console.log(t),p(JSON.stringify(t,null,2)),e.onSubmit&&e.onSubmit(t)},children:"submit"}),Object(d.jsx)("pre",{children:s})]})},S=(n(87),n(28)),L=n(9),I=n.n(L),F={"circle-stroke-width":2,"circle-radius":8,"circle-blur":.15,"circle-color":"#3770C6","circle-stroke-color":"white"},B=function(e){var t=a.a.useContext(S.c);return a.a.useEffect((function(){if(t){var e=new I.a.Popup({closeButton:!1,closeOnClick:!1});t.on("mouseenter","position-marker",(function(n){t.getCanvas().style.cursor="pointer";for(var r=n.features[0].geometry.coordinates.slice(),a=n.features[0].properties,o="";Math.abs(n.lngLat.lng-r[0])>180;)r[0]+=n.lngLat.lng>r[0]?360:-360;for(var i in e.setLngLat(r).addTo(t),a){var c=i+": ";"DroneID"===i?o+=c="<strong>"+a[i]+"</strong><br>":"id"!==i&&(o+=c+a[i]+"<br>",console.log(a[i]),e.setHTML(o))}})),t.on("click","position-marker",(function(e){t.flyTo({center:e.features[0].geometry.coordinates})})),t.on("mouseenter","position-marker",(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave","position-marker",(function(){t.getCanvas().style.cursor="",e.remove()}))}}),[t]),Object(d.jsx)(S.b,{type:"circle",id:"position-marker",paint:F,children:e.droneLocations.map((function(e,t){return Object(d.jsx)(S.a,{coordinates:[e.long,e.lat],properties:{DroneID:e.id,Longitude:e.long,Latitude:e.lat,"Battery Level":e.batteryLvl,"Average Speed":e.avgSpeed,"Average Bearing":e.avgBearing,"Average Current":e.avgCurrent}},t)}))})},E=function(e){var t=a.a.useContext(S.c),n=Object(r.useRef)(null),o=Object(r.useRef)(null),i=Object(r.useRef)(null),u=function(t){var n=t.map((function(e){var t=Object(c.a)(e,2);return{long:t[0],lat:t[1]}}));e.onChange&&e.onChange(n)};function s(e,t){o.current.features.splice(e,0,function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{description:"<p>"+JSON.stringify(e)+"</p>",tag:JSON.stringify(e)}}}(t)),i.current.features[0].geometry.coordinates.splice(e,0,t),l(),u(i.current.features[0].geometry.coordinates)}function l(){t.getSource("lines").setData(i.current),t.getSource("points").setData(o.current)}function d(e){var n,r=[e.point.x,e.point.y],a=r[0],i=r[1],c=t.queryRenderedFeatures([[a-5,i-5],[a+5,i+5]],{layers:["points"]});return c.length>0?(n=c[0].properties.tag,o.current.features.findIndex((function(e){return e.properties.tag===n}))):null}function p(e){if(n.current.a&&n.current.a.index===e)return function(e){o.current.features.splice(e,1),i.current.features[0].geometry.coordinates.splice(e,1),l(),u(i.current.features[0].geometry.coordinates)}(e),void g();n.current.b&&n.current.b.marker.remove(),n.current.a&&(n.current.b=n.current.a);var r=(new I.a.Marker).setLngLat(o.current.features[e].geometry.coordinates).addTo(t);n.current.a={index:e,marker:r}}function f(e){0===o.current.features.length?(s(0,e),p(0)):2===Object.keys(n.current).length?function(e){var t=n.current.a.index,r=n.current.b.index;if(t>r){var a=[r,t];t=a[0],r=a[1]}r-t===1&&(s(r,e),g())}(e):1===Object.keys(n.current).length?function(e){var t=o.current.features.length;n.current.a.index===o.current.features.length-1?(s(t,e),g(),p(t)):0===n.current.a.index&&(s(0,e),g(),p(0))}(e):t.panTo(o.current.features[0].geometry.coordinates)}function g(){n.current.a&&n.current.a.marker.remove(),n.current.b&&n.current.b.marker.remove(),n.current={}}function v(e){27===e.keyCode&&g()}return a.a.useEffect((function(){if(t)return n.current={},i.current={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]},o.current={type:"FeatureCollection",features:[]},t.addSource("lines",{type:"geojson",data:i.current}),t.addSource("points",{type:"geojson",data:o.current}),t.addLayer({id:"lines",type:"line",source:"lines",paint:{"line-color":"yellow","line-opacity":.75,"line-width":5}}),t.addLayer({id:"points",type:"circle",source:"points",paint:{"circle-radius":6,"circle-color":"#B42222"}}),t.on("click",(function(e){var t=d(e);null!==t?p(t):f([e.lngLat.lng,e.lngLat.lat])})),t.on("contextmenu",(function(){g()})),window.addEventListener("keydown",v),function(){window.removeEventListener("keydown",v)}}),[t]),null},A=Object(S.d)({accessToken:"pk.eyJ1Ijoic3BpZGVyMjI5OCIsImEiOiJja3VzOGN1cWUwY2M5MndtZmZ1Nm0wdHZqIn0.rsbsUbg1W7V0Ev9aAXGGsA"}),M=function(e){var t=e.droneLocations,n=e.onChange;return Object(d.jsx)("div",{children:Object(d.jsxs)(A,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100%",width:"100%"},children:[Object(d.jsx)(B,{droneLocations:t}),Object(d.jsx)(E,{onChange:n})]})})};function N(){var e=a.a.useState([]),t=Object(c.a)(e,2),n=t[0],r=t[1],o=a.a.useState([]),i=Object(c.a)(o,2),u=i[0],l=i[1];return Object(d.jsxs)("div",{className:s.a.appContainer,children:[Object(d.jsxs)("div",{children:[Object(d.jsx)(k,{onSubmit:r}),Object(d.jsx)(g,{waypoints:u})]}),Object(d.jsx)(M,{droneLocations:n,onChange:l})]})}i.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(N,{})}),document.getElementById("root"))}},[[92,1,2]]]);
//# sourceMappingURL=main.b92de8aa.chunk.js.map