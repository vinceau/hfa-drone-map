(this["webpackJsonphfa-drone-map"]=this["webpackJsonphfa-drone-map"]||[]).push([[0],{12:function(e,t,n){e.exports={appContainer:"App_appContainer__3jRx1"}},14:function(e,t,n){e.exports={fileInputContainer:"FileInput_fileInputContainer__2FREY"}},15:function(e,t,n){},26:function(e,t,n){"use strict";n.r(t);n(15);var r=n(0),o=n.n(r),a=n(5),i=n.n(a),c=n(3),s=n(12),u=n.n(s),l=n(1),d=function(e){var t=e.boatId,n=e.waypoints,r=e.disabled,o=void 0!==r&&r,a=e.filename,i=void 0===a?"data.csv":a,c=e.contentType,s=void 0===c?"data:text/csv;charset=utf-8,":c;return Object(l.jsx)("button",{disabled:o,onClick:function(){var e="boatId,waypointNumber,latitude,longitude\n";!function(e,t,n){if(navigator.msSaveBlob){var r=new Blob([e],{type:n});navigator.msSaveBlob(r,t)}else{var o=document.createElement("a");o.style.display="none",o.setAttribute("href",n+encodeURIComponent(e)),o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}(e+=n.map((function(e,n){return p(t,n,e)})).join("\n"),i,s)},children:"download"})},p=function(e,t,n){return"".concat(e,",").concat(t+1,",").concat(n.lat.toFixed(6),",").concat(n.long.toFixed(6))},f=function(e){var t=e.waypoints,n=o.a.useState(""),r=Object(c.a)(n,2),a=r[0],i=r[1];return Object(l.jsxs)("div",{children:[Object(l.jsx)("input",{placeholder:"Boat ID",value:a,onChange:function(e){return i(e.target.value)}}),Object(l.jsx)(d,{disabled:!a||0===t.length,boatId:a,waypoints:t})]})},g=n(9),b=n.n(g),j=n(13),m=/[SW]$/,v=function(e){var t=1;return m.test(e)&&(t=-1),t*parseFloat(e.substring(0,e.length-1))},y=n(14),h=n.n(y),x=function(e){var t=o.a.useState("M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0"),n=Object(c.a)(t,2),r=n[0],a=n[1],i=o.a.useState(""),s=Object(c.a)(i,2),u=s[0],d=s[1],p=function(){var e=Object(j.a)(b.a.mark((function e(t){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files,console.log(n),e.next=4,Promise.all(Array.from(n).map((function(e){return t=e,new Promise((function(e,n){var r=new FileReader;r.onabort=function(){return n("file reading was aborted")},r.onerror=function(){return n("file reading has failed")},r.readAsText?(r.addEventListener("load",(function(){var t=null!=this.resultString?this.resultString:this.result;e(t)}),!1),r.readAsText(t)):n("Failed to read file")}));var t})));case 4:r=e.sent,a(r.join("\n"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(l.jsxs)("div",{className:h.a.fileInputContainer,children:[Object(l.jsx)("label",{htmlFor:"fileInput",children:"Select a CSV file:"}),Object(l.jsx)("input",{type:"file",id:"fileInput",name:"fileInput",multiple:!0,onChange:p}),Object(l.jsx)("textarea",{value:r,onChange:function(e){return a(e.target.value)},rows:20}),Object(l.jsx)("button",{onClick:function(){var t=function(e){return e.split("\n").map((function(e){console.log(e);var t=e.split(",");return 0===t.length?null:(console.log("chunks length: ",t.length),"M"!==t[0]||7!==t.length?null:{id:t[1],lat:v(t[2]),long:v(t[3])})})).filter((function(e){return null!==e}))}(r);console.log(t),d(JSON.stringify(t,null,2)),e.onSubmit&&e.onSubmit(t)},children:"submit"}),Object(l.jsx)("pre",{children:u})]})},O=(n(22),n(4)),C=n(2),S=n.n(C),w={"circle-stroke-width":2,"circle-radius":8,"circle-blur":.15,"circle-color":"#3770C6","circle-stroke-color":"white"},I=function(e){var t=o.a.useContext(O.c);return o.a.useEffect((function(){if(t){var e=new S.a.Popup({closeButton:!1,closeOnClick:!1});t.on("mouseenter","position-marker",(function(n){t.getCanvas().style.cursor="pointer";for(var r=n.features[0].geometry.coordinates.slice(),o=n.features[0].properties,a="";Math.abs(n.lngLat.lng-r[0])>180;)r[0]+=n.lngLat.lng>r[0]?360:-360;for(var i in e.setLngLat(r).addTo(t),o){var c=i+": ";"DroneID"===i?a+=c="<strong>"+o[i]+"</strong><br>":"id"!==i&&(a+=c+o[i]+"<br>",console.log(o[i]),e.setHTML(a))}})),t.on("click","position-marker",(function(e){t.flyTo({center:e.features[0].geometry.coordinates})})),t.on("mouseenter","position-marker",(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave","position-marker",(function(){t.getCanvas().style.cursor="",e.remove()}))}}),[t]),Object(l.jsx)(O.b,{type:"circle",id:"position-marker",paint:w,children:e.droneLocations.map((function(e,t){return Object(l.jsx)(O.a,{coordinates:[e.long,e.lat],properties:{DroneID:e.id,longitude:e.long,latitude:e.lat}},t)}))})},L=function(e){var t=o.a.useContext(O.c),n=Object(r.useRef)(null),a=Object(r.useRef)(null),i=Object(r.useRef)(null),s=function(t){var n=t.map((function(e){var t=Object(c.a)(e,2);return{long:t[0],lat:t[1]}}));e.onChange&&e.onChange(n)};function u(e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{description:"<p>"+JSON.stringify(e)+"</p>",tag:JSON.stringify(e)}}}function l(){t.getSource("lines").setData(a.current),t.getSource("points").setData(n.current)}function d(e){var n=[e.point.x,e.point.y],r=n[0],o=n[1],a=t.queryRenderedFeatures([[r-5,o-5],[r+5,o+5]],{layers:["points"]});return a.length>0?{coordinates:a[0].geometry.coordinates.slice(),description:a[0].properties.description,tag:a[0].properties.tag}:{}}function p(e){i.current=e}function f(){return i.current}return o.a.useEffect((function(){t&&(a.current={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]},n.current={type:"FeatureCollection",features:[]},t.addSource("lines",{type:"geojson",data:a.current}),t.addSource("points",{type:"geojson",data:n.current}),t.addLayer({id:"lines",type:"line",source:"lines",paint:{"line-color":"yellow","line-opacity":.75,"line-width":5}}),t.addLayer({id:"points",type:"circle",source:"points",paint:{"circle-radius":6,"circle-color":"#B42222"}}),t.on("click",(function(e){var r=d(e),o=r.coordinates,i=r.description,c=r.tag;if(o&&i&&c){for(;Math.abs(e.lngLat.lng-o[0])>180;)o[0]+=e.lngLat.lng>o[0]?360:-360;(new S.a.Popup).setLngLat(o).setHTML(i).addTo(t)}else{var g=e.lngLat,b=g.lng,j=g.lat;null!==f()?function(e,t){n.current.features.splice(e,0,u(t)),a.current.features[0].geometry.coordinates.splice(e,0,t),l(),s(a.current.features[0].geometry.coordinates)}(f()+1,[b,j]):function(e){n.current.features.push(u(e)),a.current.features[0].geometry.coordinates.push(e),l(),s(a.current.features[0].geometry.coordinates)}([b,j]),p(null)}})),t.on("contextmenu",(function(e){var t=d(e).tag;if(t){var r=function(e){return n.current.features.findIndex((function(t){return t.properties.tag===e}))}(t);f()!==r?i.current=r:(!function(e){n.current.features.splice(e,1),a.current.features[0].geometry.coordinates.splice(e,1),l(),s(a.current.features[0].geometry.coordinates)}(f()),p(null))}})))}),[t]),null},k=Object(O.d)({accessToken:"pk.eyJ1Ijoic3BpZGVyMjI5OCIsImEiOiJja3VzOGN1cWUwY2M5MndtZmZ1Nm0wdHZqIn0.rsbsUbg1W7V0Ev9aAXGGsA"}),F=function(e){var t=e.droneLocations,n=e.onChange;return Object(l.jsx)("div",{children:Object(l.jsxs)(k,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100%",width:"100%"},children:[Object(l.jsx)(I,{droneLocations:t}),Object(l.jsx)(L,{onChange:n})]})})};function M(){var e=o.a.useState([]),t=Object(c.a)(e,2),n=t[0],r=t[1],a=o.a.useState([]),i=Object(c.a)(a,2),s=i[0],d=i[1];return Object(l.jsxs)("div",{className:u.a.appContainer,children:[Object(l.jsxs)("div",{children:[Object(l.jsx)(x,{onSubmit:r}),Object(l.jsx)(f,{waypoints:s})]}),Object(l.jsx)(F,{droneLocations:n,onChange:d})]})}i.a.render(Object(l.jsx)(o.a.StrictMode,{children:Object(l.jsx)(M,{})}),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.6ee0d228.chunk.js.map