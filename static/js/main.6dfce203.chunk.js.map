{"version":3,"sources":["components/FileInput.module.css","App.module.css","components/CsvDownloadButton.js","lib/createDownloadableFile.js","components/CsvDownloader.js","lib/mapCsvToPositions.js","components/FileInput.js","lib/readFile.js","components/Map/MapDronePoints.js","components/Map/MapFeatures.js","components/Map/Map.js","App.js","index.js"],"names":["module","exports","CsvDownloadButton","boatId","waypoints","disabled","filename","contentType","Button","onClick","fileContents","data","navigator","msSaveBlob","blob","Blob","type","element","document","createElement","style","display","setAttribute","encodeURIComponent","body","appendChild","click","removeChild","createDownloadableFile","map","point","i","generateCsvEntryString","join","index","lat","toFixed","long","CsvDownloader","React","useState","text","setText","placeholder","value","onChange","e","target","length","isNegativeCoordinate","mapStringToFloat","str","sign","test","parseFloat","substring","FileInput","props","result","setResult","onFileChange","a","files","console","log","Promise","all","Array","from","f","file","resolve","reject","fr","FileReader","onabort","onerror","readAsText","addEventListener","string","this","resultString","strings","className","styles","fileInputContainer","id","name","multiple","uploadInput","htmlFor","Tooltip","title","Fab","component","rows","res","split","line","chunks","filter","r","mapCsvToPositions","JSON","stringify","onSubmit","POSITION_CIRCLE_PAINT","MapDronePoints","useContext","MapContext","useEffect","popup","mapboxgl","Popup","closeButton","closeOnClick","on","getCanvas","cursor","coordinates","features","geometry","slice","properties","popupLabels","Math","abs","lngLat","lng","key","setLngLat","addTo","setHTML","flyTo","center","remove","paint","droneLocations","loc","DroneID","longitude","latitude","MapFeatures","points","useRef","lines","selectedIndex","addPoint","description","tag","refreshMap","getSource","setData","current","findPointFeature","x","y","selectedFeatures","queryRenderedFeatures","layers","setSelectedIndex","getSelectedIndex","addSource","addLayer","source","splice","insertPointAt","push","addPointToEnd","findIndex","el","getIndexOfTag","removePointAt","Map","ReactMapboxGl","accessToken","process","MapView","containerStyle","height","width","App","setDroneLocations","setWaypoints","appContainer","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.6dfce203.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"fileInputContainer\":\"FileInput_fileInputContainer__2FREY\",\"uploadInput\":\"FileInput_uploadInput__3LcYe\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"appContainer\":\"App_appContainer__3jRx1\"};","import Button from \"@mui/material/Button\";\nimport React from \"react\";\n\nimport { createDownloadableFile } from \"../lib/createDownloadableFile\";\n\nconst ROUNDING_ACCURACY = 6;\n\nexport const CsvDownloadButton = ({\n  boatId,\n  waypoints,\n  disabled = false,\n  filename = \"data.csv\",\n  contentType = \"data:text/csv;charset=utf-8,\",\n}) => {\n  const onClick = () => {\n    let fileContents = \"boatId,waypointNumber,latitude,longitude\\n\";\n    fileContents += waypoints.map((point, i) => generateCsvEntryString(boatId, i, point)).join(\"\\n\");\n    createDownloadableFile(fileContents, filename, contentType);\n  };\n\n  return (\n    <Button disabled={disabled} onClick={onClick}>\n      download\n    </Button>\n  );\n};\n\nconst generateCsvEntryString = (boatId, index, data) => {\n  return `${boatId},${index + 1},${data.lat.toFixed(ROUNDING_ACCURACY)},${data.long.toFixed(ROUNDING_ACCURACY)}`;\n};\n","// Taken from: https://medium.com/@szpytfire/create-a-downloadable-file-using-javascript-typescript-c7d8bf798baa\n\nexport const createDownloadableFile = (data, filename, contentType) => {\n  // IE 11\n  if (navigator.msSaveBlob) {\n    // Use IE11's APIs\n    const blob = new Blob([data], {\n      type: contentType,\n    });\n    navigator.msSaveBlob(blob, filename);\n    return;\n  }\n\n  // Other browsers\n  // Create a hidden anchor link\n  const element = document.createElement(\"a\");\n  element.style.display = \"none\";\n\n  // Attach the content to the anchor\n  element.setAttribute(\"href\", contentType + encodeURIComponent(data));\n  element.setAttribute(\"download\", filename);\n  // Append to DOM and simulate click (this will trigger the download)\n  document.body.appendChild(element);\n  element.click();\n  // Cleanup\n  document.body.removeChild(element);\n};\n","import React from \"react\";\nimport { CsvDownloadButton } from \"./CsvDownloadButton\";\n\nexport const CsvDownloader = ({ waypoints }) => {\n  const [text, setText] = React.useState(\"\");\n\n  return (\n    <div>\n      <input placeholder=\"Boat ID\" value={text} onChange={(e) => setText(e.target.value)} />\n      <CsvDownloadButton disabled={!text || waypoints.length === 0} boatId={text} waypoints={waypoints} />\n    </div>\n  );\n};\n","const isNegativeCoordinate = /[SW]$/;\n\nexport const mapCsvToPositions = (text) => {\n  const results = text.split(\"\\n\").map((line) => {\n    console.log(line);\n    const chunks = line.split(\",\");\n    if (chunks.length === 0) {\n      return null;\n    }\n    console.log(\"chunks length: \", chunks.length);\n    const code = chunks[0];\n    if (code !== \"M\" || chunks.length !== 7) {\n      return null;\n    }\n    const id = chunks[1];\n    const lat = mapStringToFloat(chunks[2]);\n    const long = mapStringToFloat(chunks[3]);\n    return { id, lat, long };\n  });\n  return results.filter((r) => r !== null);\n};\n\nconst mapStringToFloat = (str) => {\n  let sign = 1;\n  if (isNegativeCoordinate.test(str)) {\n    sign = -1;\n  }\n  return sign * parseFloat(str.substring(0, str.length - 1));\n};\n","import UploadFileIcon from \"@mui/icons-material/UploadFile\";\nimport Button from \"@mui/material/Button\";\nimport Fab from \"@mui/material/Fab\";\nimport Tooltip from \"@mui/material/Tooltip\";\nimport React from \"react\";\n\nimport { mapCsvToPositions } from \"../lib/mapCsvToPositions\";\nimport { readFileAsText } from \"../lib/readFile\";\nimport styles from \"./FileInput.module.css\";\n\nconst defaultValue = `M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0`;\n\nexport const FileInput = (props) => {\n  const [text, setText] = React.useState(defaultValue);\n  const [result, setResult] = React.useState(\"\");\n\n  const onClick = () => {\n    const res = mapCsvToPositions(text);\n    console.log(res);\n    setResult(JSON.stringify(res, null, 2));\n\n    // Return the result to parent\n    if (props.onSubmit) {\n      props.onSubmit(res);\n    }\n  };\n\n  const onFileChange = async (e) => {\n    const files = e.target.files;\n    console.log(files);\n    const strings = await Promise.all(Array.from(files).map((f) => readFileAsText(f)));\n    setText(strings.join(\"\\n\"));\n  };\n\n  return (\n    <div className={styles.fileInputContainer}>\n      <input\n        type=\"file\"\n        id=\"fileInput\"\n        name=\"fileInput\"\n        multiple={true}\n        onChange={onFileChange}\n        className={styles.uploadInput}\n      />\n      <label htmlFor=\"fileInput\">\n        <Tooltip title={\"Upload a CSV File\"}>\n          <Fab component={\"span\"}>\n            <UploadFileIcon />\n          </Fab>\n        </Tooltip>\n      </label>\n      <textarea value={text} onChange={(e) => setText(e.target.value)} rows={20} />\n      <Button onClick={onClick}>submit</Button>\n      <pre>{result}</pre>\n    </div>\n  );\n};\n","export const readFileAsText = (file) => {\n  return new Promise((resolve, reject) => {\n    const fr = new FileReader();\n    fr.onabort = () => reject(\"file reading was aborted\");\n    fr.onerror = () => reject(\"file reading has failed\");\n    if (fr.readAsText) {\n      fr.addEventListener(\n        \"load\",\n        function () {\n          const string = this.resultString != null ? this.resultString : this.result;\n          resolve(string);\n        },\n        false,\n      );\n      fr.readAsText(file);\n    } else {\n      reject(\"Failed to read file\");\n    }\n  });\n};\n","import mapboxgl from \"mapbox-gl\";\nimport React from \"react\";\nimport { Feature, Layer, MapContext } from \"react-mapbox-gl\";\n\nconst POSITION_CIRCLE_PAINT = {\n  \"circle-stroke-width\": 2,\n  \"circle-radius\": 8,\n  \"circle-blur\": 0.15,\n  \"circle-color\": \"#3770C6\",\n  \"circle-stroke-color\": \"white\",\n};\n\nexport const MapDronePoints = (props) => {\n  const map = React.useContext(MapContext);\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    // popup creation for each drone\n    const popup = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false,\n    });\n\n    map.on(\"mouseenter\", \"position-marker\", (e) => {\n      map.getCanvas().style.cursor = \"pointer\";\n      const coordinates = e.features[0].geometry.coordinates.slice();\n      const properties = e.features[0].properties;\n      var popupLabels = \"\";\n\n      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n      }\n\n      popup.setLngLat(coordinates).addTo(map);\n\n      for (var key in properties) {\n        var title = key + \": \";\n        if (key === \"DroneID\") {\n          title = \"<strong>\" + properties[key] + \"</strong><br>\";\n          popupLabels += title;\n        } else if (key !== \"id\") {\n          popupLabels += title + properties[key] + \"<br>\";\n          console.log(properties[key]);\n          popup.setHTML(popupLabels);\n        }\n      }\n    });\n\n    map.on(\"click\", \"position-marker\", (e) => {\n      map.flyTo({\n        center: e.features[0].geometry.coordinates,\n      });\n    });\n\n    map.on(\"mouseenter\", \"position-marker\", () => {\n      map.getCanvas().style.cursor = \"pointer\";\n    });\n\n    map.on(\"mouseleave\", \"position-marker\", () => {\n      map.getCanvas().style.cursor = \"\";\n      popup.remove();\n    });\n  }, [map]);\n\n  // Drawing the layers contain the location of each drone.\n  return (\n    <Layer type=\"circle\" id=\"position-marker\" paint={POSITION_CIRCLE_PAINT}>\n      {props.droneLocations.map((loc, index) => (\n        <Feature\n          key={index}\n          coordinates={[loc.long, loc.lat]}\n          properties={{ DroneID: loc.id, longitude: loc.long, latitude: loc.lat }}\n        />\n      ))}\n    </Layer>\n  );\n};\n","import mapboxgl from \"mapbox-gl\";\nimport React, { useRef } from \"react\";\nimport { MapContext } from \"react-mapbox-gl\";\n\nexport const MapFeatures = (props) => {\n  const map = React.useContext(MapContext);\n\n  const points = useRef(null);\n  const lines = useRef(null);\n  const selectedIndex = useRef(null);\n\n  const onChange = (data) => {\n    const res = data.map(([long, lat]) => ({ long, lat }));\n    if (props.onChange) {\n      props.onChange(res);\n    }\n  };\n\n  function addPoint(coordinates) {\n    return {\n      type: \"Feature\",\n      geometry: {\n        type: \"Point\",\n        coordinates,\n      },\n      properties: {\n        description: \"<p>\" + JSON.stringify(coordinates) + \"</p>\",\n        tag: JSON.stringify(coordinates),\n      },\n    };\n  }\n\n  function init() {\n    lines.current = {\n      type: \"FeatureCollection\",\n      features: [\n        {\n          type: \"Feature\",\n          geometry: {\n            type: \"LineString\",\n            coordinates: [],\n          },\n        },\n      ],\n    };\n\n    points.current = {\n      type: \"FeatureCollection\",\n      features: [],\n    };\n\n    map.addSource(\"lines\", { type: \"geojson\", data: lines.current });\n    map.addSource(\"points\", { type: \"geojson\", data: points.current });\n\n    map.addLayer({\n      id: \"lines\",\n      type: \"line\",\n      source: \"lines\",\n      paint: {\n        \"line-color\": \"yellow\",\n        \"line-opacity\": 0.75,\n        \"line-width\": 5,\n      },\n    });\n\n    map.addLayer({\n      id: \"points\",\n      type: \"circle\",\n      source: \"points\",\n      paint: {\n        \"circle-radius\": 6,\n        \"circle-color\": \"#B42222\",\n      },\n    });\n  }\n\n  function getIndexOfTag(tag) {\n    return points.current.features.findIndex((el) => el.properties.tag === tag);\n  }\n\n  function insertPointAt(index, coordinates) {\n    points.current.features.splice(index, 0, addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.splice(index, 0, coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function addPointToEnd(coordinates) {\n    points.current.features.push(addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.push(coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function removePointAt(index) {\n    points.current.features.splice(index, 1);\n    lines.current.features[0].geometry.coordinates.splice(index, 1);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function refreshMap() {\n    map.getSource(\"lines\").setData(lines.current);\n    map.getSource(\"points\").setData(points.current);\n  }\n\n  function findPointFeature(e) {\n    const [x, y] = [e.point.x, e.point.y];\n\n    const selectedFeatures = map.queryRenderedFeatures(\n      [\n        [x - 5, y - 5],\n        [x + 5, y + 5],\n      ],\n      {\n        layers: [\"points\"],\n      },\n    );\n\n    if (selectedFeatures.length > 0) {\n      return {\n        coordinates: selectedFeatures[0].geometry.coordinates.slice(),\n        description: selectedFeatures[0].properties.description,\n        tag: selectedFeatures[0].properties.tag,\n      };\n    } else {\n      return {};\n    }\n  }\n\n  function setSelectedIndex(index) {\n    selectedIndex.current = index;\n    // console.log('hi')\n    // if (index === null) return\n    // const marker = new mapboxgl.Marker()\n    //   .setLngLat(points.current.features[index].geometry.coordinates)\n    //   .addTo(map);\n  }\n\n  function getSelectedIndex() {\n    return selectedIndex.current;\n  }\n\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    init();\n\n    map.on(\"click\", (e) => {\n      const { coordinates, description, tag } = findPointFeature(e);\n\n      if (coordinates && description && tag) {\n        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n          coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n        }\n\n        new mapboxgl.Popup().setLngLat(coordinates).setHTML(description).addTo(map);\n      } else {\n        const { lng, lat } = e.lngLat;\n\n        if (getSelectedIndex() !== null) {\n          insertPointAt(getSelectedIndex() + 1, [lng, lat]);\n        } else {\n          addPointToEnd([lng, lat]);\n        }\n        setSelectedIndex(null);\n      }\n    }); // click\n\n    map.on(\"contextmenu\", (e) => {\n      const { tag } = findPointFeature(e);\n\n      if (!tag) {\n        return;\n      }\n\n      const index = getIndexOfTag(tag);\n\n      if (getSelectedIndex() !== index) {\n        selectedIndex.current = index;\n      } else {\n        removePointAt(getSelectedIndex());\n        setSelectedIndex(null);\n      }\n    }); // contextmenu\n  }, [map]);\n\n  return null;\n};\n","import \"mapbox-gl/dist/mapbox-gl.css\";\n\nimport React from \"react\";\nimport ReactMapboxGl from \"react-mapbox-gl\";\n\nimport { MapDronePoints } from \"./MapDronePoints\";\nimport { MapFeatures } from \"./MapFeatures\";\n\n// eslint-disable-next-line new-cap\nconst Map = ReactMapboxGl({\n  accessToken: process.env.REACT_APP_MAPBOX_KEY,\n});\n\nexport const MapView = ({ droneLocations, onChange }) => {\n  return (\n    <div>\n      <Map\n        style=\"mapbox://styles/mapbox/streets-v9\"\n        containerStyle={{\n          height: \"100%\",\n          width: \"100%\",\n        }}\n      >\n        <MapDronePoints droneLocations={droneLocations} />\n\n        <MapFeatures onChange={onChange} />\n      </Map>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport styles from \"./App.module.css\";\nimport { CsvDownloader } from \"./components/CsvDownloader\";\nimport { FileInput } from \"./components/FileInput\";\nimport { MapView } from \"./components/Map/Map\";\n\nfunction App() {\n  const [droneLocations, setDroneLocations] = React.useState([]);\n  const [waypoints, setWaypoints] = React.useState([]);\n\n  return (\n    <div className={styles.appContainer}>\n      <div>\n        <FileInput onSubmit={setDroneLocations} />\n        <CsvDownloader waypoints={waypoints} />\n      </div>\n      <MapView droneLocations={droneLocations} onChange={setWaypoints} />\n    </div>\n  );\n}\n\nexport { App };\n","import \"./index.css\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { App } from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\"),\n);\n"],"sourceRoot":""}