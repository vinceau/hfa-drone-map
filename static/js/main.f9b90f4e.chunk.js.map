{"version":3,"sources":["App.module.css","components/FileInput.module.css","components/CsvDownloadButton.js","lib/createDownloadableFile.js","lib/mapCsvToPositions.js","components/FileInput.js","lib/readFile.js","components/Map/MapFeatures.js","components/Map/MapDronePoints.js","components/Map/Map.js","App.js","index.js"],"names":["module","exports","CsvDownloadButton","waypoints","filename","contentType","fileContents","map","point","i","generateCsvEntryString","join","onClick","data","navigator","msSaveBlob","blob","Blob","type","element","document","createElement","style","display","setAttribute","encodeURIComponent","body","appendChild","click","removeChild","createDownloadableFile","boatId","index","lat","toFixed","long","isNegativeCoordinate","mapStringToFloat","str","sign","test","parseFloat","substring","length","FileInput","props","React","useState","text","setText","result","setResult","onFileChange","e","a","files","target","console","log","Promise","all","Array","from","f","file","resolve","reject","fr","FileReader","onabort","onerror","readAsText","addEventListener","string","this","resultString","strings","className","styles","fileInputContainer","htmlFor","id","name","multiple","onChange","value","rows","res","split","line","chunks","filter","r","mapCsvToPositions","JSON","stringify","onSubmit","MapFeatures","useContext","MapContext","points","useRef","lines","selectedIndex","addPoint","coordinates","geometry","properties","description","tag","refreshMap","getSource","setData","current","findPointFeature","x","y","selectedFeatures","queryRenderedFeatures","layers","slice","setSelectedIndex","getSelectedIndex","useEffect","features","addSource","addLayer","source","paint","on","Math","abs","lngLat","lng","mapboxgl","Popup","setLngLat","setHTML","addTo","splice","insertPointAt","push","addPointToEnd","findIndex","el","getIndexOfTag","removePointAt","POSITION_CIRCLE_PAINT","MapDronePoints","popup","closeButton","closeOnClick","getCanvas","cursor","popupLabels","key","title","flyTo","center","remove","droneLocations","loc","Map","ReactMapboxGl","accessToken","process","MapView","containerStyle","height","width","App","setDroneLocations","setWaypoints","appContainer","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.f9b90f4e.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"appContainer\":\"App_appContainer__3jRx1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fileInputContainer\":\"FileInput_fileInputContainer__2FREY\"};","import React from \"react\";\nimport { createDownloadableFile } from \"../lib/createDownloadableFile\";\n\nconst ROUNDING_ACCURACY = 6;\n\nexport const CsvDownloadButton = ({\n  waypoints,\n  filename = \"data.csv\",\n  contentType = \"data:text/csv;charset=utf-8,\",\n}) => {\n  let fileContents = \"boatId,waypointNumber,latitude,longitude\\n\";\n  fileContents += waypoints.map((point, i) => generateCsvEntryString(\"boatId\", i, point)).join(\"\\n\");\n  const onClick = () => {\n    createDownloadableFile(fileContents, filename, contentType);\n  };\n\n  return <button onClick={onClick}>download</button>;\n};\n\nconst generateCsvEntryString = (boatId, index, data) => {\n  return `${boatId},${index + 1},${data.lat.toFixed(ROUNDING_ACCURACY)},${data.long.toFixed(ROUNDING_ACCURACY)}`;\n};\n","// Taken from: https://medium.com/@szpytfire/create-a-downloadable-file-using-javascript-typescript-c7d8bf798baa\n\nexport const createDownloadableFile = (data, filename, contentType) => {\n  // IE 11\n  if (navigator.msSaveBlob) {\n    // Use IE11's APIs\n    const blob = new Blob([data], {\n      type: contentType,\n    });\n    navigator.msSaveBlob(blob, filename);\n    return;\n  }\n\n  // Other browsers\n  // Create a hidden anchor link\n  const element = document.createElement(\"a\");\n  element.style.display = \"none\";\n\n  // Attach the content to the anchor\n  element.setAttribute(\"href\", contentType + encodeURIComponent(data));\n  element.setAttribute(\"download\", filename);\n  // Append to DOM and simulate click (this will trigger the download)\n  document.body.appendChild(element);\n  element.click();\n  // Cleanup\n  document.body.removeChild(element);\n};\n","const isNegativeCoordinate = /[SW]$/\n\nexport const mapCsvToPositions = (text) => {\n  const results = text.split(\"\\n\").map((line) => {\n    console.log(line);\n    const chunks = line.split(\",\");\n    if (chunks.length === 0) {\n      return null;\n    }\n    console.log(\"chunks length: \", chunks.length);\n    const code = chunks[0];\n    if (code !== \"M\" || chunks.length !== 7) {\n      return null;\n    }\n    const id = chunks[1];\n    const lat = mapStringToFloat(chunks[2]);\n    const long = mapStringToFloat(chunks[3]);\n    return { id, lat, long };\n  });\n  return results.filter((r) => r !== null);\n};\n\nconst mapStringToFloat = (str) => {\n  let sign = 1.\n  if (isNegativeCoordinate.test(str)) {\n    sign = -1.\n  }\n  return sign * parseFloat(str.substring(0, str.length - 1));\n};\n","import React from \"react\";\n\nimport styles from \"./FileInput.module.css\";\nimport { mapCsvToPositions } from \"../lib/mapCsvToPositions\";\nimport { readFileAsText } from \"../lib/readFile\";\n\nconst defaultValue = `M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0`;\n\nexport const FileInput = (props) => {\n  const [text, setText] = React.useState(defaultValue);\n  const [result, setResult] = React.useState(\"\");\n\n  const onClick = () => {\n    const res = mapCsvToPositions(text);\n    console.log(res);\n    setResult(JSON.stringify(res, null, 2));\n\n    // Return the result to parent\n    if (props.onSubmit) {\n      props.onSubmit(res);\n    }\n  };\n\n  const onFileChange = async (e) => {\n    const files = e.target.files;\n    console.log(files);\n    const strings = await Promise.all(Array.from(files).map((f) => readFileAsText(f)));\n    setText(strings.join(\"\\n\"));\n  };\n\n  return (\n    <div className={styles.fileInputContainer}>\n      <label htmlFor=\"fileInput\">Select a CSV file:</label>\n      <input type=\"file\" id=\"fileInput\" name=\"fileInput\" multiple={true} onChange={onFileChange} />\n      <textarea value={text} onChange={(e) => setText(e.target.value)} rows={20} />\n      <button onClick={onClick}>submit</button>\n      <pre>{result}</pre>\n    </div>\n  );\n};\n","export const readFileAsText = (file) => {\n  return new Promise((resolve, reject) => {\n    const fr = new FileReader();\n    fr.onabort = () => reject(\"file reading was aborted\");\n    fr.onerror = () => reject(\"file reading has failed\");\n    if (fr.readAsText) {\n      fr.addEventListener(\n        \"load\",\n        function () {\n          const string = this.resultString != null ? this.resultString : this.result;\n          resolve(string);\n        },\n        false,\n      );\n      fr.readAsText(file);\n    } else {\n      reject(\"Failed to read file\");\n    }\n  });\n};\n","import React, { useRef } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\nimport { MapContext } from \"react-mapbox-gl\";\n\nexport const MapFeatures = (props) => {\n  const map = React.useContext(MapContext);\n\n  const points = useRef(null);\n  const lines = useRef(null);\n  const selectedIndex = useRef(null);\n  const selectMarker = useRef(null);\n\n  const onChange = (data) => {\n    const res = data.map(([long, lat]) => ({ long, lat }));\n    if (props.onChange) {\n      props.onChange(res);\n    }\n  };\n\n  function addPoint(coordinates) {\n    return {\n      type: \"Feature\",\n      geometry: {\n        type: \"Point\",\n        coordinates,\n      },\n      properties: {\n        description: \"<p>\" + JSON.stringify(coordinates) + \"</p>\",\n        tag: JSON.stringify(coordinates),\n      },\n    };\n  }\n\n  function init() {\n    lines.current = {\n      type: \"FeatureCollection\",\n      features: [\n        {\n          type: \"Feature\",\n          geometry: {\n            type: \"LineString\",\n            coordinates: [],\n          },\n        },\n      ],\n    };\n\n    points.current = {\n      type: \"FeatureCollection\",\n      features: [],\n    };\n\n    map.addSource(\"lines\", { type: \"geojson\", data: lines.current });\n    map.addSource(\"points\", { type: \"geojson\", data: points.current });\n\n    map.addLayer({\n      id: \"lines\",\n      type: \"line\",\n      source: \"lines\",\n      paint: {\n        \"line-color\": \"yellow\",\n        \"line-opacity\": 0.75,\n        \"line-width\": 5,\n      },\n    });\n\n    map.addLayer({\n      id: \"points\",\n      type: \"circle\",\n      source: \"points\",\n      paint: {\n        \"circle-radius\": 6,\n        \"circle-color\": \"#B42222\",\n      },\n    });\n  }\n\n  function getIndexOfTag(tag) {\n    return points.current.features.findIndex((el) => el.properties.tag === tag);\n  }\n\n  function insertPointAt(index, coordinates) {\n    points.current.features.splice(index, 0, addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.splice(index, 0, coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function addPointToEnd(coordinates) {\n    points.current.features.push(addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.push(coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function removePointAt(index) {\n    points.current.features.splice(index, 1);\n    lines.current.features[0].geometry.coordinates.splice(index, 1);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function refreshMap() {\n    map.getSource(\"lines\").setData(lines.current);\n    map.getSource(\"points\").setData(points.current);\n  }\n\n  function findPointFeature(e) {\n    const [x, y] = [e.point.x, e.point.y];\n\n    const selectedFeatures = map.queryRenderedFeatures(\n      [\n        [x - 5, y - 5],\n        [x + 5, y + 5],\n      ],\n      {\n        layers: [\"points\"],\n      },\n    );\n\n    if (selectedFeatures.length > 0) {\n      return {\n        coordinates: selectedFeatures[0].geometry.coordinates.slice(),\n        description: selectedFeatures[0].properties.description,\n        tag: selectedFeatures[0].properties.tag,\n      };\n    } else {\n      return {};\n    }\n  }\n\n  function setSelectedIndex(index) {\n    selectedIndex.current = index;\n    // console.log('hi')\n    // if (index === null) return\n    // const marker = new mapboxgl.Marker()\n    //   .setLngLat(points.current.features[index].geometry.coordinates)\n    //   .addTo(map);\n  }\n\n  function getSelectedIndex() {\n    return selectedIndex.current;\n  }\n\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    init();\n\n    map.on(\"click\", (e) => {\n      const { coordinates, description, tag } = findPointFeature(e);\n\n      if (coordinates && description && tag) {\n        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n          coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n        }\n\n        new mapboxgl.Popup().setLngLat(coordinates).setHTML(description).addTo(map);\n      } else {\n        const { lng, lat } = e.lngLat;\n\n        if (getSelectedIndex() !== null) {\n          insertPointAt(getSelectedIndex() + 1, [lng, lat]);\n        } else {\n          addPointToEnd([lng, lat]);\n        }\n        setSelectedIndex(null);\n      }\n    }); // click\n\n    map.on(\"contextmenu\", (e) => {\n      const { tag } = findPointFeature(e);\n\n      if (!tag) return;\n\n      const index = getIndexOfTag(tag);\n\n      if (getSelectedIndex() !== index) {\n        selectedIndex.current = index;\n      } else {\n        removePointAt(getSelectedIndex());\n        setSelectedIndex(null);\n      }\n    }); // contextmenu\n  }, [map]);\n\n  return null;\n};\n","import React, { useRef } from \"react\";\nimport ReactMapboxGl, { Layer, Feature, MapContext, Popup } from \"react-mapbox-gl\";\nimport mapboxgl from \"mapbox-gl\";\n\nconst POSITION_CIRCLE_PAINT = {\n  \"circle-stroke-width\": 2,\n  \"circle-radius\": 8,\n  \"circle-blur\": 0.15,\n  \"circle-color\": \"#3770C6\",\n  \"circle-stroke-color\": \"white\",\n};\n\nexport const MapDronePoints = (props) => {\n  const map = React.useContext(MapContext);\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    // popup creation for each drone\n    const popup = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n\n    map.on('mouseenter', 'position-marker', (e) => {\n      map.getCanvas().style.cursor = 'pointer';\n      const coordinates = e.features[0].geometry.coordinates.slice();\n      const properties = e.features[0].properties;\n      var popupLabels = \"\"\n\n\n      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n      }\n\n      popup.setLngLat(coordinates).addTo(map)\n\n      for (var key in properties) {\n        var title = key + \": \"\n        if (key === \"DroneID\") {\n          title = \"<strong>\" + properties[key] + \"</strong><br>\"\n          popupLabels += title\n        }\n        else if (key !== \"id\") {\n          popupLabels += title + properties[key] + \"<br>\"\n          console.log(properties[key])\n          popup.setHTML(popupLabels)\n        }\n\n      }\n\n    })\n\n    map.on('click', 'position-marker', (e) => {\n      map.flyTo({\n        center: e.features[0].geometry.coordinates\n      });\n    });\n\n    map.on('mouseenter', 'position-marker', () => {\n      map.getCanvas().style.cursor = 'pointer';\n    });\n\n    map.on('mouseleave', 'position-marker', () => {\n      map.getCanvas().style.cursor = '';\n      popup.remove();\n    })\n\n  }, [map]);\n\n  // Drawing the layers contain the location of each drone.\n  return (<Layer type=\"circle\" id=\"position-marker\" paint={POSITION_CIRCLE_PAINT}>\n    {props.droneLocations.map((loc, index) => (\n      <Feature key={index} coordinates={[loc.long, loc.lat]} properties={{ \"DroneID\": loc.id, \"longitude\": loc.long, \"latitude\": loc.lat }} />\n    ))}\n  </Layer>);\n};\n","import React from \"react\";\nimport ReactMapboxGl from \"react-mapbox-gl\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport { MapFeatures } from \"./MapFeatures\";\nimport { MapDronePoints } from \"./MapDronePoints\";\n\nconst Map = ReactMapboxGl({\n  accessToken: process.env.REACT_APP_MAPBOX_KEY,\n});\n\nexport const MapView = ({ droneLocations, onChange }) => {\n  return (\n    <div>\n      <Map\n        style=\"mapbox://styles/mapbox/streets-v9\"\n        containerStyle={{\n          height: \"100%\",\n          width: \"100%\",\n        }}\n      >\n        <MapDronePoints droneLocations={droneLocations} />\n\n        <MapFeatures onChange={onChange} />\n      </Map>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport styles from \"./App.module.css\";\nimport { CsvDownloadButton } from \"./components/CsvDownloadButton\";\nimport { FileInput } from \"./components/FileInput\";\nimport { MapView } from \"./components/Map/Map\";\n\nfunction App() {\n  const [droneLocations, setDroneLocations] = React.useState([]);\n  const [waypoints, setWaypoints] = React.useState([]);\n\n  return (\n    <div className={styles.appContainer}>\n      <div>\n        <FileInput onSubmit={setDroneLocations} />\n        <CsvDownloadButton waypoints={waypoints} />\n      </div>\n      <MapView droneLocations={droneLocations} onChange={setWaypoints} />\n    </div>\n  );\n}\n\nexport { App };\n","import \"./index.css\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { App } from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\"),\n);\n"],"sourceRoot":""}