{"version":3,"sources":["App.module.css","FileInput.module.css","components/CsvDownloadButton.js","lib/createDownloadableFile.js","lib/mapCsvToPositions.js","FileInput.js","lib/readFile.js","Map/MapFeatures.js","Map/MapDronePoints.js","Map/Map.js","App.js","index.js"],"names":["module","exports","CsvDownloadButton","waypoints","filename","contentType","fileContents","map","point","i","lat","long","join","onClick","data","navigator","msSaveBlob","blob","Blob","type","element","document","createElement","style","display","setAttribute","encodeURIComponent","body","appendChild","click","removeChild","createDownloadableFile","isNegativeCoordinate","mapStringToFloat","str","sign","test","parseFloat","substring","length","FileInput","props","React","useState","text","setText","result","setResult","onFileChange","e","a","files","target","console","log","Promise","all","Array","from","f","file","resolve","reject","fr","FileReader","onabort","onerror","readAsText","addEventListener","string","this","resultString","strings","className","styles","fileInputContainer","htmlFor","id","name","multiple","onChange","value","rows","res","split","line","chunks","filter","r","mapCsvToPositions","JSON","stringify","onSubmit","MapFeatures","useContext","MapContext","points","useRef","lines","selectedIndex","addPoint","coordinates","geometry","properties","description","tag","refreshMap","getSource","setData","current","findPointFeature","x","y","selectedFeatures","queryRenderedFeatures","layers","slice","setSelectedIndex","index","getSelectedIndex","useEffect","features","addSource","addLayer","source","paint","on","Math","abs","lngLat","lng","mapboxgl","Popup","setLngLat","setHTML","addTo","splice","insertPointAt","push","addPointToEnd","findIndex","el","getIndexOfTag","removePointAt","POSITION_CIRCLE_PAINT","MapDronePoints","popup","closeButton","closeOnClick","getCanvas","cursor","popupLabels","key","title","flyTo","center","remove","droneLocations","loc","Map","ReactMapboxGl","accessToken","process","MapView","containerStyle","height","width","App","setDroneLocations","setWaypoints","appContainer","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.af2feee3.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"appContainer\":\"App_appContainer__3jRx1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fileInputContainer\":\"FileInput_fileInputContainer__3K1pc\"};","import React from \"react\";\nimport { createDownloadableFile } from \"../lib/createDownloadableFile\";\n\nexport const CsvDownloadButton = ({\n  waypoints,\n  filename = \"data.csv\",\n  contentType = \"data:text/csv;charset=utf-8,\",\n}) => {\n  let fileContents = \"boatId,waypointNumber,latitude,longitude\\n\";\n  fileContents += waypoints.map((point, i) => `boatId,${i + 1},${point.lat},${point.long}`).join(\"\\n\");\n  const onClick = () => {\n    createDownloadableFile(fileContents, filename, contentType);\n  };\n\n  return <button onClick={onClick}>download</button>;\n};\n","// Taken from: https://medium.com/@szpytfire/create-a-downloadable-file-using-javascript-typescript-c7d8bf798baa\n\nexport const createDownloadableFile = (data, filename, contentType) => {\n  // IE 11\n  if (navigator.msSaveBlob) {\n    // Use IE11's APIs\n    const blob = new Blob([data], {\n      type: contentType,\n    });\n    navigator.msSaveBlob(blob, filename);\n    return;\n  }\n\n  // Other browsers\n  // Create a hidden anchor link\n  const element = document.createElement(\"a\");\n  element.style.display = \"none\";\n\n  // Attach the content to the anchor\n  element.setAttribute(\"href\", contentType + encodeURIComponent(data));\n  element.setAttribute(\"download\", filename);\n  // Append to DOM and simulate click (this will trigger the download)\n  document.body.appendChild(element);\n  element.click();\n  // Cleanup\n  document.body.removeChild(element);\n};\n","const isNegativeCoordinate = /[SW]$/\n\nexport const mapCsvToPositions = (text) => {\n  const results = text.split(\"\\n\").map((line) => {\n    console.log(line);\n    const chunks = line.split(\",\");\n    if (chunks.length === 0) {\n      return null;\n    }\n    console.log(\"chunks length: \", chunks.length);\n    const code = chunks[0];\n    if (code !== \"M\" || chunks.length !== 7) {\n      return null;\n    }\n    const id = chunks[1];\n    const lat = mapStringToFloat(chunks[2]);\n    const long = mapStringToFloat(chunks[3]);\n    return { id, lat, long };\n  });\n  return results.filter((r) => r !== null);\n};\n\nconst mapStringToFloat = (str) => {\n  let sign = 1.\n  if (isNegativeCoordinate.test(str)) {\n    sign = -1.\n  }\n  return sign * parseFloat(str.substring(0, str.length - 1));\n};\n","import React from \"react\";\n\nimport styles from \"./FileInput.module.css\";\nimport { mapCsvToPositions } from \"./lib/mapCsvToPositions\";\nimport { readFileAsText } from \"./lib/readFile\";\n\nconst defaultValue = `M,UL997,37.821608S,145.313996E,470668.68,3,3.4\nP,UL997,12.68,26.3,3.4,41.3,0.0`;\n\nexport const FileInput = (props) => {\n  const [text, setText] = React.useState(defaultValue);\n  const [result, setResult] = React.useState(\"\");\n\n  const onClick = () => {\n    const res = mapCsvToPositions(text);\n    console.log(res);\n    setResult(JSON.stringify(res, null, 2));\n\n    // Return the result to parent\n    if (props.onSubmit) {\n      props.onSubmit(res);\n    }\n  };\n\n  const onFileChange = async (e) => {\n    const files = e.target.files;\n    console.log(files);\n    const strings = await Promise.all(Array.from(files).map((f) => readFileAsText(f)));\n    setText(strings.join(\"\\n\"));\n  };\n\n  return (\n    <div className={styles.fileInputContainer}>\n      <label htmlFor=\"fileInput\">Select a CSV file:</label>\n      <input type=\"file\" id=\"fileInput\" name=\"fileInput\" multiple={true} onChange={onFileChange} />\n      <textarea value={text} onChange={(e) => setText(e.target.value)} rows={20} />\n      <button onClick={onClick}>submit</button>\n      <pre>{result}</pre>\n    </div>\n  );\n};\n","export const readFileAsText = (file) => {\n  return new Promise((resolve, reject) => {\n    const fr = new FileReader();\n    fr.onabort = () => reject(\"file reading was aborted\");\n    fr.onerror = () => reject(\"file reading has failed\");\n    if (fr.readAsText) {\n      fr.addEventListener(\n        \"load\",\n        function () {\n          const string = this.resultString != null ? this.resultString : this.result;\n          resolve(string);\n        },\n        false,\n      );\n      fr.readAsText(file);\n    } else {\n      reject(\"Failed to read file\");\n    }\n  });\n};\n","import React, { useRef } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\nimport { MapContext } from \"react-mapbox-gl\";\n\nexport const MapFeatures = (props) => {\n  const map = React.useContext(MapContext);\n\n  const points = useRef(null);\n  const lines = useRef(null);\n  const selectedIndex = useRef(null);\n  const selectMarker = useRef(null);\n\n  const onChange = (data) => {\n    const res = data.map(([long, lat]) => ({ long, lat }));\n    if (props.onChange) {\n      props.onChange(res);\n    }\n  };\n\n  function addPoint(coordinates) {\n    return {\n      type: \"Feature\",\n      geometry: {\n        type: \"Point\",\n        coordinates,\n      },\n      properties: {\n        description: \"<p>\" + JSON.stringify(coordinates) + \"</p>\",\n        tag: JSON.stringify(coordinates),\n      },\n    };\n  }\n\n  function init() {\n    lines.current = {\n      type: \"FeatureCollection\",\n      features: [\n        {\n          type: \"Feature\",\n          geometry: {\n            type: \"LineString\",\n            coordinates: [],\n          },\n        },\n      ],\n    };\n\n    points.current = {\n      type: \"FeatureCollection\",\n      features: [],\n    };\n\n    map.addSource(\"lines\", { type: \"geojson\", data: lines.current });\n    map.addSource(\"points\", { type: \"geojson\", data: points.current });\n\n    map.addLayer({\n      id: \"lines\",\n      type: \"line\",\n      source: \"lines\",\n      paint: {\n        \"line-color\": \"yellow\",\n        \"line-opacity\": 0.75,\n        \"line-width\": 5,\n      },\n    });\n\n    map.addLayer({\n      id: \"points\",\n      type: \"circle\",\n      source: \"points\",\n      paint: {\n        \"circle-radius\": 6,\n        \"circle-color\": \"#B42222\",\n      },\n    });\n  }\n\n  function getIndexOfTag(tag) {\n    return points.current.features.findIndex((el) => el.properties.tag === tag);\n  }\n\n  function insertPointAt(index, coordinates) {\n    points.current.features.splice(index, 0, addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.splice(index, 0, coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function addPointToEnd(coordinates) {\n    points.current.features.push(addPoint(coordinates));\n    lines.current.features[0].geometry.coordinates.push(coordinates);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function removePointAt(index) {\n    points.current.features.splice(index, 1);\n    lines.current.features[0].geometry.coordinates.splice(index, 1);\n    refreshMap();\n    onChange(lines.current.features[0].geometry.coordinates);\n  }\n\n  function refreshMap() {\n    map.getSource(\"lines\").setData(lines.current);\n    map.getSource(\"points\").setData(points.current);\n  }\n\n  function findPointFeature(e) {\n    const [x, y] = [e.point.x, e.point.y];\n\n    const selectedFeatures = map.queryRenderedFeatures(\n      [\n        [x - 5, y - 5],\n        [x + 5, y + 5],\n      ],\n      {\n        layers: [\"points\"],\n      },\n    );\n\n    if (selectedFeatures.length > 0) {\n      return {\n        coordinates: selectedFeatures[0].geometry.coordinates.slice(),\n        description: selectedFeatures[0].properties.description,\n        tag: selectedFeatures[0].properties.tag,\n      };\n    } else {\n      return {};\n    }\n  }\n\n  function setSelectedIndex(index) {\n    selectedIndex.current = index;\n    // console.log('hi')\n    // if (index === null) return\n    // const marker = new mapboxgl.Marker()\n    //   .setLngLat(points.current.features[index].geometry.coordinates)\n    //   .addTo(map);\n  }\n\n  function getSelectedIndex() {\n    return selectedIndex.current;\n  }\n\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    init();\n\n    map.on(\"click\", (e) => {\n      const { coordinates, description, tag } = findPointFeature(e);\n\n      if (coordinates && description && tag) {\n        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n          coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n        }\n\n        new mapboxgl.Popup().setLngLat(coordinates).setHTML(description).addTo(map);\n      } else {\n        const { lng, lat } = e.lngLat;\n\n        if (getSelectedIndex() !== null) {\n          insertPointAt(getSelectedIndex() + 1, [lng, lat]);\n        } else {\n          addPointToEnd([lng, lat]);\n        }\n        setSelectedIndex(null);\n      }\n    }); // click\n\n    map.on(\"contextmenu\", (e) => {\n      const { tag } = findPointFeature(e);\n\n      if (!tag) return;\n\n      const index = getIndexOfTag(tag);\n\n      if (getSelectedIndex() !== index) {\n        selectedIndex.current = index;\n      } else {\n        removePointAt(getSelectedIndex());\n        setSelectedIndex(null);\n      }\n    }); // contextmenu\n  }, [map]);\n\n  return null;\n};\n","import React, { useRef } from \"react\";\nimport ReactMapboxGl, { Layer, Feature, MapContext, Popup } from \"react-mapbox-gl\";\nimport mapboxgl from \"mapbox-gl\";\n\nconst POSITION_CIRCLE_PAINT = {\n  \"circle-stroke-width\": 2,\n  \"circle-radius\": 8,\n  \"circle-blur\": 0.15,\n  \"circle-color\": \"#3770C6\",\n  \"circle-stroke-color\": \"white\",\n};\n\nexport const MapDronePoints = (props) => {\n  const map = React.useContext(MapContext);\n  React.useEffect(() => {\n    if (!map) {\n      return;\n    }\n\n    // popup creation for each drone\n    const popup = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n\n    map.on('mouseenter', 'position-marker', (e) => {\n      map.getCanvas().style.cursor = 'pointer';\n      const coordinates = e.features[0].geometry.coordinates.slice();\n      const properties = e.features[0].properties;\n      var popupLabels = \"\"\n\n\n      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n      }\n\n      popup.setLngLat(coordinates).addTo(map)\n\n      for (var key in properties) {\n        var title = key + \": \"\n        if (key === \"DroneID\") {\n          title = \"<strong>\" + properties[key] + \"</strong><br>\"\n          popupLabels += title\n        }\n        else if (key !== \"id\") {\n          popupLabels += title + properties[key] + \"<br>\"\n          console.log(properties[key])\n          popup.setHTML(popupLabels)\n        }\n\n      }\n\n    })\n\n    map.on('click', 'position-marker', (e) => {\n      map.flyTo({\n        center: e.features[0].geometry.coordinates\n      });\n    });\n\n    map.on('mouseenter', 'position-marker', () => {\n      map.getCanvas().style.cursor = 'pointer';\n    });\n\n    map.on('mouseleave', 'position-marker', () => {\n      map.getCanvas().style.cursor = '';\n      popup.remove();\n    })\n\n  }, [map]);\n\n  // Drawing the layers contain the location of each drone.\n  return (<Layer type=\"circle\" id=\"position-marker\" paint={POSITION_CIRCLE_PAINT}>\n    {props.droneLocations.map((loc, index) => (\n      <Feature key={index} coordinates={[loc.long, loc.lat]} properties={{ \"DroneID\": loc.id, \"longitude\": loc.long, \"latitude\": loc.lat }} />\n    ))}\n  </Layer>);\n};\n","import React from \"react\";\nimport ReactMapboxGl from \"react-mapbox-gl\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport { MapFeatures } from \"./MapFeatures\";\nimport { MapDronePoints } from \"./MapDronePoints\";\n\nconst Map = ReactMapboxGl({\n  accessToken: process.env.REACT_APP_MAPBOX_KEY,\n});\n\nexport const MapView = ({ droneLocations, onChange }) => {\n  return (\n    <div>\n      <Map\n        style=\"mapbox://styles/mapbox/streets-v9\"\n        containerStyle={{\n          height: \"100%\",\n          width: \"100%\",\n        }}\n      >\n        <MapDronePoints droneLocations={droneLocations} />\n\n        <MapFeatures onChange={onChange} />\n      </Map>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport styles from \"./App.module.css\";\nimport { CsvDownloadButton } from \"./components/CsvDownloadButton\";\nimport { FileInput } from \"./FileInput\";\nimport { MapView } from \"./Map/Map\";\n\nfunction App() {\n  const [droneLocations, setDroneLocations] = React.useState([]);\n  const [waypoints, setWaypoints] = React.useState([]);\n\n  return (\n    <div className={styles.appContainer}>\n      <div>\n        <FileInput onSubmit={setDroneLocations} />\n        <CsvDownloadButton waypoints={waypoints} />\n      </div>\n      <MapView droneLocations={droneLocations} onChange={setWaypoints} />\n    </div>\n  );\n}\n\nexport { App };\n","import \"./index.css\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { App } from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\"),\n);\n"],"sourceRoot":""}